define(["jquery","core/config","core/log","block_course_overview/collapsible","core/str"],function(a,b,c,d,e){var f,g,h,i=function(b,d,e,g){var h,i=g.statusCode();if(!i||200!=i.status||d.error){for(c.error("ERROR getting overviews for courses: "+b),h=0;h<b.length;h++)m(b[h]);for(h=0;h<f.length;h++)m(f[h])}else{var j=d.courses.length;for(h=0;j>h;h++){l(d.courses[h].id);var n=a("div#course-"+d.courses[h].id+" .course_title");n.after(d.courses[h].content),a("div#course-"+d.courses[h].id+" .collapsibleregion").each(k)}}},j=function(){if(!(f.length<=0)){var c=f.splice(0,g),d={courseids:c.join(",")};a.get(b.wwwroot+"/blocks/course_overview/overview_ajax.php",d,"json").done(function(a,b,d){i(c,a,b,d),f.length>0&&j()}).fail(function(){var a;for(a=0;a<c.length;a++)m(c[a]);for(a=0;f>a;a++)m(f[a])})}},k=function(b,c){e.get_string("clicktohideshow","moodle").done(function(b){d.collapsible(a(c).attr("id"),!1,b)})},l=function(b){a("#course-"+b+" img.overview_state").hide()},m=function(b){var c=a("#course-"+b+" img.overview_state");e.get_string("cannotloadoverview","block_course_overview").done(function(a){c.attr("alt",a),c.attr("title",a)}),c.attr("src",h)};return{init:function(a,b,d){c.debug("overview.init: overviewStep="+b),f=a.filter(function(a){return a>0?!0:!1}),f.length>0&&(g=b,h=d,j())}}});